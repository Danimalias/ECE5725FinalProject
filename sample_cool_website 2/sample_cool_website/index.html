
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Starter Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="finalproject.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Mini Las Vegas Sphere</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#intro">Introduction</a></li>
            <li><a href="#obj">Project Objective</a></li>
            <li><a href="#design">Design and Testing</a></li>
            <li><a href="#Mechanical Build">Mechanical Build</a></li>
            <li><a href="#Result">Result</a></li>
            <li><a href="#Further Exploration">Further Exploration</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

      <div class="starter-template">
        <h1>Mini Las Vegas Sphere</h1>
        <p class="lead">ECE 5725 Final Project<br>by Daniela Tran (dht35) and Anne Liu (ayl47)</p>
      </div>

      <hr>
      <div class="center-block">
          <iframe width="560" height="315" src="https://www.youtube.com/embed/ObthKd80rXg?si=bUUFN7php8NgDs--" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
          <h4 style="text-align:center;">Demonstration Video</h4>
      </div>
    

      <div style="text-align:center;">
              <h2>Introduction</h2>
              <p style="text-align: left;padding: 0px 30px;">
                If you want to experience Las Vegas right in your own home then look no further because we have the perfect 
                solution for you. This project creates the mini Las Vegas sphere and it features some cool images that you might 
                see on the real sphere such as its infamous emoji and our home: the Earth. This light display will take you traveling 
                back to the city of lights. Using a persistence of vision illusion, this project uses a motor to spin a ring of 
                pulsing LEDs at a rate such that our eyes detect an illusion of an image from this movement. 
              </p>
      </div>

    <hr id='obj'>

      <div class="row">
          <div class="col-md-4" style="text-align:center;">
          <img class="img-rounded" src="pics/lasvegassphere.jpg" alt="Generic placeholder image" width="260" height="240">
          </div>
          <div class="col-md-8" style="font-size:18px;">
          <h2>Project Objective:</h2>
          <ul>
              <li>Explore the persistence of persistence illusion with LED Lights. </li>
                <li>Implement still images onto a globe structure to emulate the Las Vegas Sphere shape. </li>
            <li>Implement a UI with the Raspberry Pi TFT touchscreen.</li>
          </ul>
          </div>
      </div>

    <hr id='design'>

      <div style="text-align:center;">
              <h2>Design and Testing</h2>
              <p style="text-align: left;padding: 0px 30px;">To begin our journey, we first started our prototype 
                with a box fan as our base motor(kindly loaned to us by Professor Skovira) and a 28 Neopixel strip. 
                We found lots of 3D CAD designs online for a globe. These designs were able to be 3D printed, and so
                after some further investigating, we were able to find a ring design that would be able to fit with 
                our box fan. This CAD model had a hollow core and the ring width was just wide enough to fit the width 
                of the neopixels. It also conveniently had wire holes at the top and bottom of the ring, which allowed 
                us to attach external wires, power supplies, and sensors later. We also made sure that the radius of 
                the hollowed axel would fit snugly onto a DC motor, just in case the box fan idea does not work out.</p>
      </div>
      <div class="col-md-4" style="text-align:center;">
        <img class="img-rounded" src="pics/3D printed ring.png" alt="Generic placeholder image" width="480" height="240">
        </div>
        <h4 style="text-align:center;">3D Printed Ring Design With External Wiring Space
        </h4>

        <p style="text-align: left;padding: 0px 30px;">After the ring and motor shaft was finalized, we then layed out 
          the electrical components and the overall electrical system. This included the microcontrollers, sensors, and 
          power considerations for our system. We then reviewed this design and setup with our lab teaching assistance 
          and finalized the first draft of our Las Vegas Sphere as shown below.
        </p>

        <div class="col-md-4" style="text-align:center;">
          <img class="img-rounded" src="pics/roughdraft.png" alt="Generic placeholder image" width="480" height="240">
          </div>
          <h4 style="text-align:center;">Rough Draft of Schematic and Globe Setup</h4>
      
        <p style="text-align: left;padding: 0px 30px;">After the overall picture was created, we then began assembling 
          all of the mechanical components of our Las Vegas Sphere. This began by building a wooden frame on top of our 
          box fan to create a more stable situation for the ring to spin on. This also gave us space to add the sensors 
          and created a mount for the Raspberry Pi.
        </p>
  
        <div class="col-md-4" style="text-align:center;">
          <img class="img-rounded" src="pics/fan1.png" alt="Generic placeholder image" width="240" height="240">
          </div>
          <h4 style="text-align:center;">Wooden Frame to Support Our Spinning Ring On Top of Fan Motor Knob
          </h4>
        
        <p style="text-align: left;padding: 0px 30px;">Once we had the frames, we then proceeded to attach our ring onto the 
          fan motor by hot gluing it directly onto the knob. After this was setup, we tested our design by turning on the box 
          fan motor to see the results. We then noticed that the spinning of the motors caused everything to vibrate and shake 
          which then resulted in the globe created by the ring spinning to be shaking as well. Thus this then resulted in a shaky 
          globe or image. To further stabilize our system, we decided to build a wooden stool for the ring to lean on, in the sense 
          that we needed a better system other than hot glue to secure our ring, and we opted in for wooden planks and screws. 
          This created a secured ring that did not wobble and to finish our frame, we added a top piece of wood that was also screwed 
          on top of the slip ring to further stable our system. With this final attachment, we were completely satisfied with our 
          mechanical design and setup.
        </p>

        <p style="text-align: left;padding: 0px 30px;">Moving onwards, we began implementing our electrical design. 
          This started with us researching more into Neopixels, specifically controlling them with a Raspberry Pi. 
          We chose to use Neopixel LEDs initially because these are a brand of individually addressable(programmable) 
          R(red)G(green)B(blue) LEDs. Each LED on the Neopixel LED strip can be individually controlled by communicating
          with the tiny integrated circuit within the strip. This was essential for our needs as we could then set the 
          color and brightness of each LED pixel, independently of the others just by broadcasting different commands 
          through the Raspberry Pi(or any other Arduino microncontroller). The Neopixel strip we had purchased was from 
          Adafruit, which allowed us to use their CircuitBlinka and Neopixel libraries with the Raspberry Pi. This 
          allowed us to easily program and control each LED using their pre-made functions. We tested these LEDs 
          by running a simple for loop of turning each LED on in a loop and spun them with our box fan. 
        </p>
  
        <div class="col-md-4" style="text-align:center;">
          <img class="img-rounded" src="pics/neopixel.png" alt="Generic placeholder image" width="240" height="240">
          </div>
          <h4 style="text-align:center;">Pulsing Neopixel with Raspberry Pi 4</h4>

          <p style="text-align: left;padding: 0px 30px;">This simple test made us realize that there were several things 
            we needed to consider with our project that we had not thought of before. To start, our LEDs are attached in 
            a spherical shape, so every image we would want to capture on our display would have to be deformed to fit 
            this shape otherwise the image would appear to be “squished”. Since we are using a single LED strip but 
            separated by a distance of the diameter of our ring, this created a “front strip” and a “back strip” that 
            we would then need to program accordingly to capture the 3D picture. Another concern we had was in regards 
            to the box fan motor, which rotates at varying speeds which can cause problems in displaying a clear stable 
            image. 
          </p>

          <p style="text-align: left;padding: 0px 30px;">We began addressing these issues by starting with deforming our 
            input images to create a spherical image to display onto the globe. It turns out that many persistence of 
            vision projects had used a spherical display as it is very versatile to display multiple images in 360 degrees. 
            Thus with our research we were able to reference a sample code called genMatr.py that translated a normal 
            rectangle jpg or png into a spherical deformed image that had all of the pixels labeled and outputted a header 
            file that could be customized by the amount of LED pixels we had. Originally with the Neopixels, we had 28 
            LEDs in total, with 14 on each half of the ring and the resulting header file had a 1D array with all of the 
            pixel colors listed with headers to specify which image the header file is referring to. This array had a total 
            of 84 values with each triplet value representing the RGB value. This python script contains a deform sphere 
            method where it uses an angle calculation to produce the deformed image in pixel colors. 
          </p>

          <p style="text-align: left;padding: 0px 30px;"> It also includes methods and functions to process the inputted 
            image file and gives the user freedom to choose any images found on the internet. With this file we were able 
            to create multiple images which helped speed up the process of deconstructing the image files. We then moved 
            onward to pulsing the LEDs. This then involved the hall effect sensor. The hall effect sensor code required variable
            that could detect a change of state from the hall effect sensor detecting a magnet and not. The hall effect sensor 
            only output 1s or 0s and in this case the hall effect sensor was always high until it sensed a magner where it went low.
            This meant we developed code that would detect a change of state in the hall effect sensor from 1 to 0 to sense that there 
            was a magnet. Whenever there was a magnet the code would keep track of the current time when it sensed the magner and fire off the LEDS.
            At the same time it would use this current time to calculate the firing of the next few columns of the images and output those columns
            onto the LED strip. Our code used a EWMA which is an exponential weighting moving average that we would use to smooth out the output
            from the hall effect sensor and was used to calculate the firing time of the LEDs. </p>

    <hr id='Mechanical Build'>

      <div style="text-align:center;">
              <h2>Mechanical Build</h2>
              <p style="text-align: left;padding: 0px 30px;">After much trial and error we decided on a motor instead of the fan 
              motor for our project and build a wooden stand and 3D printed parts for the motor and the LED ring. Below is the 
              image of the stand.</p>
              <div class="col-md-4" style="text-align:center;">
                <img class="img-rounded" src="pics/stand.jpg" alt="Generic placeholder image" width="240" height="270">
                </div>
                <h4 style="text-align:center;">Mechanical Stand</h4>
              
              <p style="text-align: left;padding: 0px 30px;">We hot glued the hall effect sensor onto the LED ring and attached a
              stationary magnet onto the side of the wood by drilling a metal nail for the magnet to stick to.</p>

              <div class="col-md-4" style="text-align:center;">
                <img class="img-rounded" src="pics/hall.jpg" alt="Generic placeholder image" width="240" height="270">
                </div>
                <h4 style="text-align:center;">Hall Effect Sensor </h4>
                <div class="col-md-4" style="text-align:center;">
                  <img class="img-rounded" src="pics/magnet.jpg" alt="Generic placeholder image" width="240" height="270">
                  </div>
                  <h4 style="text-align:center;">Magnet on Stand </h4>
            <p style="text-align: left;padding: 0px 30px;">
      </div>

    <hr id='Result'>

      <div style="text-align:center;">
              <h2>Results and Conclusion</h2>
              <p style="text-align: left;padding: 0px 30px;">Fortunately, everything did go as planned, in the sense that we 
                were successful in displaying multiple images onto the globe and created a controller that switched between 
                photos at an immediate pace. Due to time constraints and our personal final schedules, we were not able to 
                display animations or gifs that we had mentioned before starting this project. We did test Neopixels and had 
                cool LED patterns running with the Raspberry Pi but because this was not our initial intentions, we then moved 
                onto creating more detailed images that spun at a more constant rate with the Dotstars and the ESP32 
                microcontroller. This ultimately helped achieved our vision of the Mini Las Vegas sphere as the images displayed 
                on the globe appeared to be crisp and had well defined curves/lines.</p>

              <p style="text-align: left;padding: 0px 30px;">To conclude, this project really took us on a rollercoaster of 
                excitement, anxiety, and confusion. For both partners in this final project, neither of us had experience 
                with Dotstar LEDs and this class was our first chance in dealing with persistence of vision. Despite stepping 
                outside of our comfort zone in the beginning, we were able to overcome our roadblocks and setbacks, ultimately 
                creating a working prototype that displays images just like the LED sphere in Las Vegas, Nevada. Through this 
                process of testing and redesigning our prototype we learned that having an additional controlling pin, such 
                as the CLK(clock) pin on the Dotstar can really upgrade and increase the functionality of the project, in 
                the sense that the images became much more crisp and relayed our vision more accurately. We also learned that 
                common ground is extremely important when using different power sources as this can connect separate systems 
                into a whole. 
              </p>
      </div>

    <hr id='Further Exploration'>

      <div style="text-align:center;">
              <h2>Further Exploration</h2>
              <p style="text-align: left;padding: 0px 30px;">Our project definitely leaves room for improvement, as any image 
                is now able to be portrayed onto the globe. We did test our globe with multiple images and we found that most 
                images taken from the internet would work, however images with higher contrast like the Raspberry Pi logo 
                performed better than images with a lower contrast like the Moon or Death Star. 
              </p>
              <p style="text-align: left;padding: 0px 30px;">However with the genMatr.py file, the user can plug in any photo 
                and have it displayed onto the globe. Thus, in the future the Raspberry Pi can grab images from the web using 
                UDP communication and have the image data be transferred as a header file from the Raspberry Pi directly to the 
                ESP32, which would then broadcast the images appropriately onto the globe. The communication between the 
                Raspberry Pi and ESP32 would be much slower as the data transfer size is much larger, but this would still 
                allow the user to input any image in real time onto the globe. The main exploration would probably be surrounding 
                this communication bridge as well as the UDP communication protocols, as data loss in data transfer can be quite 
                delicate to work with, especially transfer larger bit sequences, such as the header file. Another hardware 
                improvement would be to solder together all of the connections to create a more permanent connection, thus 
                eliminating the random blinks from the LEDs as it spins, which would overall improve the user experience. 
                With these improvements made, further exploration could involve creating animations and rotating the images 
                on the globe, which we had thought of doing with multiple image frames in a loop and have the ESP32 grab 
                each image frame as time increases. This was not tested but theoretically would produce a rotating image 
                with some lag, further exploration can look into created a genMatrVideos.py file which would convert any 
                video into header files with all pixels colored.
              </p>
      </div>

    <hr>

    <div class="row" style="text-align:center;">
          <h2>Work Distribution</h2>
          <div style="text-align:center;">
              <img class="img-rounded" src="pics/groupphoto.jpg" alt="Generic placeholder image" style="width:80%;">
              <h4>Project group picture</h4>
          </div>
          <div class="col-md-6" style="font-size:16px">
              <img class="img-rounded" src="pics/dan.jpg" alt="Generic placeholder image" width="240" height="300">
              <h3>Daniela Tran</h3>
              <p class="lead">dht35@cornell.edu</p>
              <p>Daniela built the mechanical stand with the LED strip and the hall effect sensor. She developed the code to 
                light up the LED lights after sensing a change in the hall effect sensor and helped develop the python code
                to deform the images into a spherical shape. Daniela was responsible for editing the HTML and CSS code for 
                the website and created the BOM for the project. She also wrote out the mechanical build portion and hall
                effect portion for the website as well as the references and parts list. 
              </p>
          </div>
          <div class="col-md-6" style="font-size:16px">
              <img class="img-rounded" src="pics/anne.jpg" alt="Generic placeholder image" width="240" height="350">
              <h3>Anne Liu</h3>
              <p class="lead">ayl47@cornell.edu</p>
              <p>Anne was responsible for the communication between the ESP32 and the Raspberry Pi using UART. She also helped 
                develop the code to control the onset firing time of the LEDs and wrote most of the text on the website. She also 
                commented out the code for easy viewing and helped develop the 3D printed parts for the mechanical build like the 
                LED ring and the container for the motor. Anne also helped find the images that were placed on the display. 
          </div>
      </div>

    <hr>
      <div style="font-size:18px">
          <h2>Parts List</h2>
          <ul>
              <li>Raspberry Pi $35.00 (provided in lab)</li>
              <li>Adafruit PiTFT Plus 320x240 2.8" TFT + Capacitive Touchscreen $44.95 (provided in lab)</li>
              <a href="https://www.amazon.com/gp/product/B07688TQ42"><li>30W High Speed CW/CCW Permanent Magnet DC Motor for DIY Generator (24V 7000 RPM)  $22.78</li></a>
              <a href="https://www.adafruit.com/product/2329"><li>Adafruit Dotstar LED Strip - $24.95</li></a>
              <a href="https://www.adafruit.com/product/736"><li>Adafruit Slip Ring - $14.95</li></a>
              <a href="https://www.adafruit.com/product/158"><li>Adafruit Hall Effect Sensor - $2.00 (provided in lab)</li></a>
              <a href="https://www.adafruit.com/product/3405"><li>Adafruit Huzzah ESP32 - $19.95 (this was not bought)</li></a>
              <li>LEDs, Resistors and Wires - Provided in lab</li>
          </ul>
          <h3>Total: $62.68</h3>
      </div>
      <hr>
      <div style="font-size:18px">
          <h2>References</h2>
          <a href="https://mdwdotla.medium.com/mercator-an-esp32-based-spherical-persistence-of-vision-display-a4beff4f826e">Mercator Project</a><br>
          <a href="https://learn.adafruit.com/adafruit-dotstar-leds/overview">Adafruit DotStar Overview</a><br>
          <a href="http://abyz.co.uk/rpi/pigpio/">Pigpio Library</a><br>
          <a href="https://www.geogebra.org/m/tb88mqrm">EWMA Filter</a><br>
          <a href="https://sourceforge.net/p/raspberry-gpio-python/wiki/Home/">R-Pi GPIO Document</a><br>
          <a href="https://maker.pro/arduino/tutorial/how-to-use-a-hall-effect-sensor-with-arduino">Hall Effect Sensor Tutorial</a><br>
      </div>

    <hr>

      <div class="row">
              <h2>Code Appendix</h2>
              <pre><code>
// Hello World.c
int main(){
  printf("Hello World.\n");
}
              </code></pre>
      </div>

    </div><!-- /.container -->




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
  </body>
</html>
